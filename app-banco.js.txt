const Sequelize = require('sequelize');

// Parte 1: Configuração de conexão com o banco de dados
// nome da base de dados, usuário, senha
const sequelize = new Sequelize('gf2018', 'adminbandtec', 'b@ndtec2018', {
  host: 'pi1-2019-2.database.windows.net', /* endereço do servidor do banco de dados */
  dialect: 'mssql', /* ou 'mysql', se for o caso */
  dialectOptions: {
	encrypt: true /* sempre deixar isso! */
  },
  pool: { /* sempre deixar isso! */
    max: 5,
    min: 1,
    acquire: 15000,
    idle: 10000
  }
});

// teste de conexão
sequelize.authenticate()
  .then(() => {
    console.log('Conectado ao banco com sucesso!');
  })
  .catch(err => {
    console.error('Erro ao tentar conectar com o banco:', err);
  });


// Parte 2: Mapeamento das tabelas
const Usuario = sequelize.define('usuario', {
  nome: {
    type: Sequelize.STRING,
    allowNull: false
  },
  login: {
    type: Sequelize.STRING,
    allowNull: false
  },
  senha: {
    type: Sequelize.STRING,
    allowNull: false
  }
});



// não mexer
module.exports = {
    sequelize: sequelize
    Usuario: Usuario
}

/*
var desenvolvimento = false;

var configuracoes = {
    producao: {
        server: "testexyzwtrtwr.database.windows.net",
        user: "adminbandtec",
        password: "b@ndtec2018",
        database: "gf2018",
        options: {
            encrypt: true
        },
        pool: {
            max: 4,
            min: 1,
            idleTimeoutMillis: 30000,
            connectionTimeout: 5000
        }
    },
    desenvolvimento: {
        server: "BASETESTE.database.windows.net",
        user: "usuariotestes",
        password: "senhatestes",
        database: "BASETESTE",
        options: {
            encrypt: true
        }
    }
}
 
var sql = require('mssql');
sql.on('error', err => {
    console.error(`Erro de Conexão: ${err}`);
});

var perfil = desenvolvimento ? 'desenvolvimento' : 'producao';

function conectar() {
  sql.close();
  return sql.connect(configuracoes[perfil])
  // return new sql.ConnectionPool();  
} 

module.exports = {
    conectar: conectar,
    sql: sql
}
*/
